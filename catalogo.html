<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Catálogo de Videojuegos</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#00ffe7;--dark:#0b0b12;--card:#1e1e3c}
    body{margin:0;font-family:'Orbitron',Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#071022 0%, #0b0b12 100%);color:#fff}
    /* header */
    header{padding:12px 18px;background:linear-gradient(90deg, rgba(0,0,0,0.18), rgba(0,0,0,0.02));}
    .topbar{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px}
    .logo{display:flex;align-items:center;gap:12px}
    .logo img{width:48px;height:48px;border-radius:8px;object-fit:cover}
    .logo h1{font-size:20px;margin:0;color:var(--accent)}
    .site-nav{margin-left:18px;display:flex;align-items:center;gap:10px}
    .site-nav a{color:#fff;text-decoration:none;padding:8px 10px;border-radius:8px;opacity:0.95}
    .site-nav a:hover{background:rgba(255,255,255,0.02);color:var(--accent)}
    .header-actions{margin-left:auto;display:flex;align-items:center;gap:10px}
    .fav-counter{background:#071022;padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
    .user-btn{background:transparent;border:1px solid var(--accent);color:var(--accent);padding:8px 10px;border-radius:8px;cursor:pointer}
    .search-input{padding:8px 10px;border-radius:8px;border:none;background:#111;color:#fff;min-width:220px}
    .platform-select{padding:8px;border-radius:8px;border:none;background:#111;color:#fff}
    .nav-toggle{display:none;background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:8px;border-radius:8px;cursor:pointer}
    @media(max-width:900px){
      .site-nav{display:none}
      .nav-toggle{display:inline-flex}
      .topbar{gap:8px}
    }
  /* focus styles for accessibility */
  :focus{outline:none}
  .focus-ring{box-shadow:0 0 0 3px rgba(0,255,231,0.12);border-radius:8px}
  /* screen-reader only */
  .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
    .hero{max-width:1100px;margin:24px auto;padding:40px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;display:flex;gap:24px;align-items:center}
    .hero img{width:320px;border-radius:12px}
    .hero .copy{flex:1}
    .cta{background:var(--accent);color:#042;display:inline-block;padding:12px 20px;border-radius:10px;font-weight:700;text-decoration:none}
    .controls{max-width:1100px;margin:20px auto;display:flex;gap:12px;align-items:center}
    .controls input,.controls select{padding:10px;border-radius:8px;border:none;background:#111;color:#fff;flex:1}
    .grid{max-width:1100px;margin:18px auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 24px rgba(0,0,0,0.6);cursor:pointer}
  .card:hover{transform:translateY(-6px);transition:transform .18s ease, box-shadow .18s ease}
  .cta:hover{transform:translateY(-3px) scale(1.02);transition:transform .12s ease}
  .card.animate-in{opacity:0;transform:translateY(6px);animation:cardIn .32s forwards ease}
  @keyframes cardIn{to{opacity:1;transform:translateY(0)}}
  .chip{display:inline-block;background:#0f1720;color:#9fd; padding:4px 8px;border-radius:12px;font-size:12px;margin-right:6px}
  .badge{display:inline-block;background:#ffb86b;color:#042;padding:4px 8px;border-radius:8px;font-weight:700;margin-left:8px}
    .card img{width:100%;height:120px;object-fit:cover;border-radius:8px}
    .card h3{color:var(--accent);margin:8px 0 6px}
    .price{color:var(--accent);font-weight:700}
    /* modal */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);align-items:center;justify-content:center}
  .modal .box{background:#070710;padding:20px;border-radius:12px;max-width:900px;width:94%}
  /* submenu transition and focus styles */
  #catalogSubmenu{display:none;opacity:0;transform:translateY(-6px);transition:opacity .18s ease, transform .18s ease;}
  #catalogSubmenu.open{display:block;opacity:1;transform:translateY(0)}
  #catalogSubmenu [role="menuitem"]:focus{outline:none;background:rgba(255,255,255,0.03);border-radius:6px}
    .modal .close{background:#ff4c4c;border:none;border-radius:50%;color:#fff;width:36px;height:36px}
  #catalogToggle{transition:transform .18s ease;display:inline-flex;align-items:center;justify-content:center}
  #catalogToggle.open{transform:rotate(180deg)}
    @media(max-width:800px){.hero{flex-direction:column}.hero img{width:100%}}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="logo">
        <img src="https://images.unsplash.com/photo-1606813902879-3b9a4b6f2f77?auto=format&fit=crop&w=600&q=60" alt="logo">
        <div>
          <h1>GameCatalog</h1>
          <div style="font-size:12px;opacity:0.8">Explora, filtra y guarda tus favoritos</div>
        </div>
      </div>

      <nav class="site-nav" aria-label="Navegación principal">
        <a href="index.html">Inicio</a>
        <div class="catalog-menu" style="position:relative;display:flex;align-items:center;gap:6px">
          <a href="catalogo.html" id="catalogLink" style="color:#fff;text-decoration:none;padding:8px 6px;border-radius:6px">Catálogo</a>
          <button id="catalogToggle" aria-haspopup="true" aria-expanded="false" aria-label="Abrir opciones de catálogo" style="background:transparent;border:none;color:#fff;padding:6px 8px;border-radius:6px;cursor:pointer">▾</button>
          <div id="catalogSubmenu" role="menu" aria-label="Opciones de catálogo" style="position:absolute;top:40px;left:0;background:#071022;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;display:none;min-width:200px;z-index:40">
            <a role="menuitem" href="catalogo.html" style="display:block;padding:8px;color:#fff;text-decoration:none">Ver todo</a>
            <a role="menuitem" href="#offers" data-action="offers" style="display:block;padding:8px;color:#fff;text-decoration:none">Ofertas</a>
            <a role="menuitem" href="#new" data-action="new" style="display:block;padding:8px;color:#fff;text-decoration:none">Nuevos lanzamientos</a>
            <button role="menuitem" id="submenuFavorites" style="display:block;padding:8px;background:transparent;border:none;color:#fff;text-align:left;width:100%;cursor:pointer">Favoritos</button>
            <div style="border-top:1px solid rgba(255,255,255,0.03);margin:6px 0"></div>
            <div style="padding:6px 8px;color:#aaa;font-size:13px">Filtrar por plataforma</div>
            <select id="submenuPlatform" style="width:100%;padding:6px;border-radius:6px;background:#111;color:#fff;border:none;margin-top:6px">
              <option value="all">Todas</option>
              <option value="PC">PC</option>
              <option value="PS5">PS5</option>
              <option value="Xbox">Xbox</option>
              <option value="Switch">Switch</option>
            </select>
          </div>
        </div>
        <a href="accion.html">Acción</a>
        <a href="#">Ofertas</a>
      </nav>

      <button id="navToggle" class="nav-toggle" aria-expanded="false" aria-label="Abrir menú">☰</button>

      <div class="header-actions">
        <form id="headerSearchForm" style="display:flex;gap:8px;align-items:center" role="search" aria-label="Buscar juegos">
          <label for="headerSearch" class="sr-only">Buscar juegos</label>
          <input id="headerSearch" class="search-input" type="search" placeholder="Buscar juegos..." aria-label="Buscar juegos" />
        </form>

        <select id="platformFilter" class="platform-select" aria-label="Filtrar por plataforma">
          <option value="all">Todas las plataformas</option>
          <option value="PC">PC</option>
          <option value="PS5">PS5</option>
          <option value="Xbox">Xbox</option>
          <option value="Switch">Switch</option>
        </select>

        <div id="favCounter" class="fav-counter" title="Ver favoritos" role="button" tabindex="0" aria-pressed="false">❤ <span id="favCount">0</span>
          <span id="favLive" class="sr-only" aria-live="polite"></span>
        </div>
        <button id="userBtn" class="user-btn" aria-haspopup="dialog">Entrar</button>
      </div>
    </div>
    <!-- mobile nav (cloned links) -->
    <nav id="mobileNav" class="site-nav" aria-hidden="true" style="display:none;margin-top:8px;padding:8px 18px;">
      <a href="index.html">Inicio</a>
      <a href="catalogo.html">Ver todo (Catálogo)</a>
      <a href="#offers" data-action="offers">Ofertas</a>
      <a href="#new" data-action="new">Nuevos lanzamientos</a>
      <a href="#" id="mobileFavorites">Favoritos</a>
      <a href="accion.html">Acción</a>
      <a href="#">Ofertas</a>
      <div style="margin-top:8px">
        <label style="font-size:13px;color:#aaa">Filtrar por plataforma</label>
        <select id="mobilePlatform" style="width:100%;padding:8px;border-radius:6px;background:#111;color:#fff;border:none;margin-top:6px">
          <option value="all">Todas</option>
          <option value="PC">PC</option>
          <option value="PS5">PS5</option>
          <option value="Xbox">Xbox</option>
          <option value="Switch">Switch</option>
        </select>
      </div>
    </nav>
  </header>

  <script src="header.js"></script>

  <section class="controls">
    <input id="search" placeholder="Buscar por título...">
    <select id="category">
      <option value="all">Todas las categorías</option>
      <option value="accion">Acción</option>
      <option value="aventura">Aventura</option>
      <option value="rpg">RPG</option>
      <option value="deportes">Deportes</option>
      <option value="estrategia">Estrategia</option>
    </select>
    <select id="sort">
      <option value="alpha">Ordenar A-Z</option>
      <option value="priceAsc">Precio: bajo a alto</option>
      <option value="priceDesc">Precio: alto a bajo</option>
      <option value="ratingDesc">Rating: alto a bajo</option>
    </select>
    <select id="platformFilter">
      <option value="all">Todas las plataformas</option>
      <option value="PC">PC</option>
      <option value="PS5">PS5</option>
      <option value="Xbox">Xbox</option>
      <option value="Switch">Switch</option>
    </select>
  </section>

  <section class="grid" id="catalogGrid"></section>

  <div class="modal" id="modal">
    <div class="box">
      <button id="closeModal" class="close">&times;</button>
      <div style="display:flex;gap:18px;flex-wrap:wrap;align-items:flex-start">
        <img id="modalImg" src="" alt="" style="width:300px;height:170px;object-fit:cover;border-radius:8px">
        <div style="flex:1">
          <h2 id="modalTitle" style="color:var(--accent)"></h2>
          <div id="modalPrice" style="color:var(--accent);font-weight:700;margin-bottom:8px"></div>
          <p id="modalDesc" style="color:#ddd;line-height:1.4"></p>
          <div style="margin-top:12px">
            <button id="buyBtn" style="background:var(--accent);color:#042;border:none;padding:10px 14px;border-radius:8px;cursor:pointer">Comprar en Steam</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const catalog = [
      {nombre:'Counter-Strike 2',categoria:'accion',precio:19.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/730/header.jpg',descripcion:'Shooter táctico competitivo.',steamAppId:730,plataforma:['PC'],rating:9.0},
      {nombre:'Apex Legends',categoria:'accion',precio:0,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/1172470/header.jpg',descripcion:'Battle royale de héroes.',steamAppId:1172470,plataforma:['PC','PS5','Xbox'],rating:8.2},
      {nombre:'Cyberpunk 2077',categoria:'aventura',precio:29.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/1091500/header.jpg',descripcion:'RPG futurista con mundo abierto.',steamAppId:1091500,plataforma:['PC','PS5','Xbox'],rating:7.5},
      {nombre:'FIFA 24',categoria:'deportes',precio:59.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/2195250/header.jpg',descripcion:'Simulador de fútbol.',steamAppId:2195250,plataforma:['PC','PS5','Xbox'],rating:7.8},
      {nombre:'DOOM Eternal',categoria:'accion',precio:39.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/782330/header.jpg',descripcion:'Shooter frenético y brutal.',steamAppId:782330,plataforma:['PC','PS5','Xbox'],rating:8.6},
      {nombre:'The Witcher 3',categoria:'rpg',precio:24.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/292030/header.jpg',descripcion:'RPG épico con una gran historia.',steamAppId:292030,plataforma:['PC','PS5','Xbox'],rating:9.5},
      {nombre:'Rocket League',categoria:'deportes',precio:19.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/252950/header.jpg',descripcion:'Fútbol con coches.',steamAppId:252950,plataforma:['PC','PS5','Xbox'],rating:8.0},
      {nombre:'Sekiro: Shadows Die Twice',categoria:'accion',precio:49.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/814380/header.jpg',descripcion:'Acción desafiante con parry.',steamAppId:814380,plataforma:['PC','PS5','Xbox'],rating:9.0},
      {nombre:'Borderlands 3',categoria:'accion',precio:39.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/397540/header.jpg',descripcion:'Shooter-looter con humor.',steamAppId:397540,plataforma:['PC','PS5','Xbox'],rating:7.9},
      {nombre:'Civilization VI',categoria:'estrategia',precio:29.99,imagen:'https://cdn.cloudflare.steamstatic.com/steam/apps/289070/header.jpg',descripcion:'Estrategia por turnos.',steamAppId:289070,plataforma:['PC','Switch'],rating:8.4}
    ];

  const grid = document.getElementById('catalogGrid');
  const search = document.getElementById('search');
  const platformFilter = document.getElementById('platformFilter');
    // header elements
    const headerSearch = document.getElementById('headerSearch');
    const headerSearchForm = document.getElementById('headerSearchForm');
    const favCounter = document.getElementById('favCounter');
    const favCount = document.getElementById('favCount');
    const userBtn = document.getElementById('userBtn');
    const category = document.getElementById('category');
    const sort = document.getElementById('sort');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalPrice = document.getElementById('modalPrice');
    const modalDesc = document.getElementById('modalDesc');
    const buyBtn = document.getElementById('buyBtn');

    // pagination & wishlist
    let currentPage = 1;
    const pageSize = 8;
    let favorites = JSON.parse(localStorage.getItem('favorites')||'[]');

  function updateFavCounter(){ const el = document.getElementById('favCount'); if(el) el.textContent = (favorites && favorites.length)? favorites.length : 0; const live = document.getElementById('favLive'); if(live) live.textContent = (favorites && favorites.length)? `Tienes ${favorites.length} favoritos` : 'No tienes favoritos'; }
    function setFavAria(){ if(favCounter) favCounter.setAttribute('aria-pressed', (favorites && favorites.length>0)? 'true' : 'false'); }
    updateFavCounter(); setFavAria();

    // parse ?search= and set inputs
    const params = new URLSearchParams(window.location.search);
    const initialSearch = params.get('search') || '';
    if(initialSearch){ headerSearch.value = initialSearch; const searchInput = document.getElementById('search'); if(searchInput) searchInput.value = initialSearch; }

    function renderCatalog(items){
      grid.innerHTML = '';
      const start = (currentPage-1)*pageSize;
      const pageItems = items.slice(start, start+pageSize);
      pageItems.forEach((item, idx)=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.name = item.nombre;
        const favActive = favorites.includes(item.nombre) ? '★' : '☆';
        const chips = item.plataforma ? item.plataforma.map(p=>`<span class="chip">${p}</span>`).join(' ') : '';
        const priceLabel = item.precio===0 ? '<span class="badge">Gratis</span>' : '<span class="price">$' + item.precio.toFixed(2) + '</span>';
        card.innerHTML = `
          <img loading="lazy" src="${item.imagen}" alt="${item.nombre}">
          <h3>${item.nombre} ${item.oferta? '<span class="badge">Oferta</span>' : ''}</h3>
          <div style="margin-top:6px">${chips}</div>
          <div style="margin-top:8px;color:#ccc;font-size:0.9em">Rating: ${item.rating}</div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
            <div>${priceLabel}</div>
            <div style="display:flex;gap:8px;align-items:center"><button class="fav-btn" data-name="${item.nombre}" aria-label="Agregar a favoritos" style="background:transparent;border:none;color:var(--accent);font-size:1.2em;cursor:pointer">${favActive}</button><button class="details-btn" style="background:var(--accent);color:#042;border:none;padding:6px 10px;border-radius:8px;cursor:pointer">Ver</button></div>
          </div>
        `;
        card.querySelector('.details-btn').addEventListener('click', ()=>openModal(item));
        card.querySelector('.fav-btn').addEventListener('click', (e)=>{ e.stopPropagation(); toggleFavorite(item.nombre, e.target); });
        const buyInline = card.querySelector('.buy-inline'); if(buyInline){ buyInline.addEventListener('click', (e)=>{ e.stopPropagation(); if(item.steamAppId) window.open('https://store.steampowered.com/app/' + item.steamAppId, '_blank'); else window.open('https://store.steampowered.com/search/?term=' + encodeURIComponent(item.nombre), '_blank'); }); }
        grid.appendChild(card);
        // animate-in with a tiny stagger
        requestAnimationFrame(()=>{ setTimeout(()=> card.classList.add('animate-in'), idx * 40); });
      });
      renderPagination(items.length);
    }

    function renderPagination(total){
      const old = document.getElementById('pager'); if(old) old.remove();
      const pages = Math.max(1, Math.ceil(total/pageSize));
      const pager = document.createElement('div'); pager.id='pager'; pager.style.display='flex'; pager.style.justifyContent='center'; pager.style.gap='8px'; pager.style.margin='18px';
      for(let i=1;i<=pages;i++){
        const b = document.createElement('button'); b.textContent = i; b.style.padding='6px 10px'; b.style.border='none'; b.style.borderRadius='6px'; b.style.cursor='pointer';
        if(i===currentPage) b.style.background='var(--accent)'; else b.style.background='#222';
        b.onclick = ()=>{ currentPage=i; applyFilters(); };
        pager.appendChild(b);
      }
      grid.parentNode.insertBefore(pager, grid.nextSibling);
    }

    function openModal(item){
      modalImg.src = item.imagen;
      modalTitle.textContent = item.nombre;
      modalPrice.textContent = item.precio===0? 'Gratis' : '$' + item.precio.toFixed(2);
      modalDesc.textContent = item.descripcion + '\n\nPlataformas: ' + item.plataforma.join(', ') + ' — Rating: ' + item.rating;
      buyBtn.onclick = function(){ if(item.steamAppId) window.open('https://store.steampowered.com/app/' + item.steamAppId, '_blank'); else window.open('https://store.steampowered.com/search/?term=' + encodeURIComponent(item.nombre), '_blank'); };
      modal.style.display = 'flex';
    }

    function toggleFavorite(name, btn){
      const idx = favorites.indexOf(name);
      if(idx===-1){ favorites.push(name); btn.textContent='★'; }
      else { favorites.splice(idx,1); btn.textContent='☆'; }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavCounter(); setFavAria();
    }

    function applyFilters(){
      const q = (document.getElementById('search').value || '').trim().toLowerCase();
      const cat = document.getElementById('category').value;
      const plat = (platformFilter && platformFilter.value) ? platformFilter.value : 'all';
      let filtered = catalog.filter(i=> (cat==='all' || i.categoria===cat) && i.nombre.toLowerCase().includes(q));
      if(plat !== 'all') filtered = filtered.filter(i=> i.plataforma && i.plataforma.includes(plat));
      if(sort.value==='alpha') filtered.sort((a,b)=>a.nombre.localeCompare(b.nombre));
      if(sort.value==='priceAsc') filtered.sort((a,b)=>a.precio - b.precio);
      if(sort.value==='priceDesc') filtered.sort((a,b)=>b.precio - a.precio);
      if(sort.value==='ratingDesc') filtered.sort((a,b)=>b.rating - a.rating);
      currentPage = 1;
      renderCatalog(filtered);
    }

    // header behavior
    headerSearchForm.addEventListener('submit', (e)=>{ e.preventDefault(); const q = headerSearch.value.trim(); if(!q) return window.location.href='catalogo.html'; window.location.href = 'catalogo.html?search=' + encodeURIComponent(q); });
    headerSearch.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ headerSearchForm.dispatchEvent(new Event('submit')); } });
    favCounter.addEventListener('click', ()=>{ if(!favorites || favorites.length===0){ alert('No tienes favoritos aún. Marca juegos con el botón ☆/★ para agregarlos.'); return; } const favItems = catalog.filter(i=>favorites.includes(i.nombre)); currentPage=1; renderCatalog(favItems); });
    favCounter.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ' || e.key==='Spacebar'){ e.preventDefault(); favCounter.click(); } });
    favCounter.addEventListener('focus', ()=> favCounter.classList.add('focus-ring')); favCounter.addEventListener('blur', ()=> favCounter.classList.remove('focus-ring'));
    userBtn.addEventListener('focus', ()=> userBtn.classList.add('focus-ring')); userBtn.addEventListener('blur', ()=> userBtn.classList.remove('focus-ring'));

  // wire basic events
  search.addEventListener('input', applyFilters);
  category.addEventListener('change', applyFilters);
  sort.addEventListener('change', applyFilters);
  if(platformFilter) platformFilter.addEventListener('change', applyFilters);
    closeModal.addEventListener('click', ()=>modal.style.display='none');
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.style.display='none'; });

    // if initial search provided, apply it
    if(initialSearch){ applyFilters(); } else { renderCatalog(catalog); }
  </script>
  <script>
    // submenu handlers (safe guards)
    const catalogLink = document.getElementById('catalogLink');
    const catalogToggle = document.getElementById('catalogToggle');
    const catalogSubmenu = document.getElementById('catalogSubmenu');
    const submenuFavorites = document.getElementById('submenuFavorites');
    const submenuPlatform = document.getElementById('submenuPlatform');
    const mobilePlatform = document.getElementById('mobilePlatform');
    
  function closeCatalogSubmenu(){ if(catalogSubmenu){ catalogSubmenu.classList.remove('open'); if(catalogToggle) catalogToggle.setAttribute('aria-expanded','false'); } }

    if(catalogToggle && catalogSubmenu){
      catalogToggle.addEventListener('click', (e)=>{
        const open = catalogToggle.getAttribute('aria-expanded') === 'true';
        if(open) closeCatalogSubmenu(); else {
          catalogSubmenu.classList.add('open'); catalogToggle.setAttribute('aria-expanded','true');
          const menuItems = Array.from(catalogSubmenu.querySelectorAll('[role="menuitem"]'));
          menuItems.forEach((it, idx)=>{ it.tabIndex = -1; it.addEventListener('focus', ()=>{ menuItems.forEach((m,i)=> m.tabIndex = (i===idx?0:-1)); });
            it.addEventListener('keydown', (ev)=>{
              if(ev.key === 'ArrowDown'){ ev.preventDefault(); const next = (idx+1) % menuItems.length; menuItems[next].focus(); }
              if(ev.key === 'ArrowUp'){ ev.preventDefault(); const prev = (idx-1 + menuItems.length) % menuItems.length; menuItems[prev].focus(); }
              if(ev.key === 'Home'){ ev.preventDefault(); menuItems[0].focus(); }
              if(ev.key === 'End'){ ev.preventDefault(); menuItems[menuItems.length-1].focus(); }
              if(ev.key === 'Escape'){ closeCatalogSubmenu(); if(catalogToggle) catalogToggle.focus(); }
            });
          });
          const first = menuItems[0]; if(first) first.focus();
          e.stopPropagation();
        }
      });
      document.addEventListener('click', (e)=>{ if(!catalogSubmenu.contains(e.target) && e.target !== catalogToggle && e.target !== catalogLink) closeCatalogSubmenu(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeCatalogSubmenu(); });
    }

    if(submenuFavorites){ submenuFavorites.addEventListener('click', ()=>{ if(!favorites || favorites.length===0){ alert('No tienes favoritos.'); return; } const favItems = catalog.filter(i=>favorites.includes(i.nombre)); currentPage=1; renderCatalog(favItems); closeCatalogSubmenu(); }); }
    if(submenuPlatform){ submenuPlatform.addEventListener('change', ()=>{ const p=submenuPlatform.value; if(platformFilter) platformFilter.value=p; if(mobilePlatform) mobilePlatform.value=p; applyFilters(); closeCatalogSubmenu(); }); }
    
      if(catalogLink && catalogToggle){
        catalogLink.addEventListener('keydown', (e)=>{
          if(e.key === 'ArrowDown'){
            e.preventDefault();
            if(catalogSubmenu) catalogSubmenu.style.display='block';
            catalogToggle.setAttribute('aria-expanded','true');
            const first = catalogSubmenu && catalogSubmenu.querySelector('[role="menuitem"]'); if(first) first.focus();
          }
        });
      }
  </script>
  <footer style="max-width:1100px;margin:24px auto;color:#aaa;padding:18px;font-size:13px;text-align:center">
    <div style="margin-bottom:8px">Enlaces rápidos: <a href="index.html" style="color:var(--accent)">Inicio</a> • <a href="accion.html" style="color:var(--accent)">Acción</a> • <a href="#" style="color:var(--accent)">Ofertas</a></div>
    <div>Créditos: datos ficticios y covers tomados de imágenes públicas. Proyecto demo por Abraham-13M.</div>
  </footer>
</body>
</html>